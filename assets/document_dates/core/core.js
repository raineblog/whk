function isLatin(t){return/^[A-Za-z\s]+$/.test(t.trim())}function extractInitials(t){if(!(t=t.trim()))return"?";if(isLatin(t)){const e=t.toUpperCase().split(/\s+/).filter(Boolean);return e.length>=2?e[0][0]+e[e.length-1][0]:e[0][0]}return t[0]}function nameToHSL(t,e=50,o=55){let a=0;for(let e=0;e<t.length;e++)a=t.charCodeAt(e)+((a<<5)-a);return`hsl(${a%360}, ${e}%, ${o}%)`}function loadAvatars(){document.querySelectorAll(".avatar-wrapper").forEach(t=>{const e=t.dataset.name||"",o=extractInitials(e),a=nameToHSL(e),r=t.querySelector(".avatar-text");r.textContent=o,r.style.backgroundColor=a;const n=t.querySelector("img.avatar");if(n){const t=[],e=(n.dataset.src||"").trim(),o=(n.dataset.email||"").trim();if(e&&t.push(e),o&&AvatarService.base){const e=md5(o.trim().toLowerCase());t.push(AvatarService.build(e))}if(0===t.length)return void(n.style.display="none");bindAvatar(n,t)}})}function bindAvatar(t,e){let o=0;function next(){o>=e.length?t.style.display="none":t.src=e[o++]}t.onerror=next,t.onload=()=>t.onerror=null,next()}const AVATAR_CDNS={gravatar:"https://www.gravatar.com/avatar",weavatar:"https://weavatar.com/avatar"},PROBE_TARGETS=[{name:"gravatar",probe:"https://www.gravatar.com/favicon.ico"},{name:"weavatar",probe:"https://weavatar.com/favicon.ico"}];let avatarServiceInited=!1;const AvatarService={base:null,async init(){if(avatarServiceInited)return;avatarServiceInited=!0;const t=await raceAvatarCDN(PROBE_TARGETS.map(t=>t.probe));if(!t)return;const e=PROBE_TARGETS.find(e=>e.probe===t);this.base=AVATAR_CDNS[e.name]},build(t,e="404",o=128){return this.base?`${this.base}/${t}?d=${e}&s=${o}`:null}};function raceAvatarCDN(t,e=500){return new Promise(o=>{let a=!1;t.forEach(t=>{const r=new Image,n=setTimeout(()=>{r.src=""},e);r.onload=()=>{a||(a=!0,clearTimeout(n),o(t))},r.onerror=()=>{clearTimeout(n)},r.src=t}),setTimeout(()=>{a||o(null)},e)})}const iconKeyMap={doc_created:"created_time",doc_updated:"updated_time",doc_author:"author",doc_authors:"authors"};function applyTimeagoToTimes(t,e){if("undefined"==typeof timeago)return;if(!t||!t.length)return;const o=ddUtils.resolveTimeagoLocale(e);t.forEach(t=>{const e=t.getAttribute("datetime");e&&(t.textContent=timeago.format(e,o))})}function processDataLoading(){const t=ddUtils.getSavedLanguage()||navigator.language||navigator.userLanguage||document.documentElement.lang||"en";document.querySelectorAll(".document-dates-plugin").forEach(e=>{applyTimeagoToTimes(e.querySelectorAll("time"),t);const o=TooltipLanguage.get(t);e.querySelectorAll("[data-tippy-content]").forEach(t=>{const e=t.querySelector("[data-icon]"),a=e?e.getAttribute("data-icon"):"",r=iconKeyMap[a]||"author";if(o[r]){const e=o[r]+": "+t.dataset.tippyRaw;t._tippy&&t._tippy.setContent(e)}})}),applyTimeagoToTimes(document.querySelectorAll("time.dd-timeago"),t)}function updateDocumentDates(t){ddUtils.saveLanguage(t),processDataLoading()}function getCurrentTheme(){return"slate"===(document.body&&document.body.getAttribute("data-md-color-scheme")||"default")?tooltip_config.theme.dark:tooltip_config.theme.light}function initTippy(){const t={tooltip_config:tooltip_config},e=tippy("[data-tippy-content]",{...tooltip_config,theme:getCurrentTheme()});t.tippyInstances=e;const o=new MutationObserver(t=>{t.forEach(t=>{if("data-md-color-scheme"===t.attributeName){const t=getCurrentTheme();e.forEach(e=>{e.setProps({theme:t})})}})});return o.observe(document.body,{attributes:!0,attributeFilter:["data-md-color-scheme"]}),t.observer=o,t}function initAuthorGroupTippyGuard(){document.querySelectorAll(".author-group").forEach(t=>{t._ddTippyGuardAbortController&&t._ddTippyGuardAbortController.abort();const e=new AbortController;t._ddTippyGuardAbortController=e;const o=t.querySelectorAll("[data-tippy-content]"),hideAllTippies=()=>{o.forEach(t=>{t._tippy&&t._tippy.hide()})},a={passive:!0,signal:e.signal};t.addEventListener("scroll",hideAllTippies,a),t.addEventListener("touchmove",hideAllTippies,a)})}window.ddPlugin={updateLanguage:updateDocumentDates};const tippyManager=(()=>{let t=[],e=null;return{initialize(){!function cleanup(){t.length>0&&(t.forEach(t=>t.destroy()),t=[]),e&&(e.disconnect(),e=null)}();const o=initTippy();o&&o.tippyInstances&&(t=o.tippyInstances),o&&o.observer&&(e=o.observer),initAuthorGroupTippyGuard()}}})();function enableHorizontalWheelScroll(){"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0||document.querySelectorAll(".author-group").forEach(t=>{t._ddWheelAbortController&&t._ddWheelAbortController.abort();const e=new AbortController;t._ddWheelAbortController=e,t.addEventListener("wheel",function(e){if(Math.abs(e.deltaY)<=Math.abs(e.deltaX))return;e.preventDefault();const o=t.scrollWidth,a=t.clientWidth;if(o<=a)return;const r=e.deltaY,n=t.scrollLeft<=0,i=t.scrollLeft+a>=o-1;(r<0&&!n||r>0&&!i)&&(t.scrollLeft+=r)},{passive:!1,signal:e.signal})})}function handleDocumentDatesAutoWrap(){document.querySelectorAll(".document-dates-plugin").forEach(t=>{const e=t.querySelector(".dd-left"),o=t.querySelector(".dd-right");if(!e||!o)return;const a=t.getBoundingClientRect().width,r=e.getBoundingClientRect().width;if(a<=r)return;const n=a<r+140;t.classList.contains("is-wrapped")!==n&&t.classList.toggle("is-wrapped",n)})}function initLayoutSwitcher(){const t=document.querySelectorAll(".article-grid");if(!t.length)return;const e=localStorage.getItem("dd_recent_docs_layout")||"grid";t.forEach(t=>{t.classList.toggle("is-list","list"===e),t.classList.toggle("is-detail","detail"===e);let o=t.previousElementSibling;if(!o||!o.classList.contains("article-layout-switcher"))return;const a=o.querySelector(".layout-list-btn"),r=o.querySelector(".layout-detail-btn"),n=o.querySelector(".layout-grid-btn"),updateActiveBtn=t=>{a&&a.classList.toggle("is-active","list"===t),r&&r.classList.toggle("is-active","detail"===t),n&&n.classList.toggle("is-active","grid"===t)};updateActiveBtn(e);const setLayout=e=>{t.classList.remove("is-list","is-detail"),"grid"!==e&&t.classList.add(`is-${e}`),localStorage.setItem("dd_recent_docs_layout",e),updateActiveBtn(e)};a&&(a.onclick=()=>{setLayout("list"),a.blur()}),r&&(r.onclick=()=>{setLayout("detail"),r.blur()}),n&&(n.onclick=()=>{setLayout("grid"),n.blur()})})}let datesAutoWrapObserver=null;function initPluginFeatures(){tippyManager.initialize(),processDataLoading(),initLayoutSwitcher(),AvatarService.init().then(()=>{loadAvatars()}),enableHorizontalWheelScroll(),datesAutoWrapObserver&&datesAutoWrapObserver.disconnect(),datesAutoWrapObserver=new ResizeObserver(()=>{window.requestAnimationFrame(()=>{handleDocumentDatesAutoWrap()})}),document.querySelectorAll(".document-dates-plugin").forEach(t=>datesAutoWrapObserver.observe(t)),setTimeout(handleDocumentDatesAutoWrap,100)}window.document$&&!window.document$.isStopped?window.document$.subscribe(initPluginFeatures):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initPluginFeatures):initPluginFeatures();
//# sourceMappingURL=core.js.map
