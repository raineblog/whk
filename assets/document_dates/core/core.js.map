{"version":3,"file":"core.js","names":["isLatin","name","test","trim","extractInitials","parts","toUpperCase","split","filter","Boolean","length","nameToHSL","s","l","hash","i","charCodeAt","loadAvatars","document","querySelectorAll","forEach","wrapper","dataset","initials","bgColor","textEl","querySelector","textContent","style","backgroundColor","imgEl","urls","dataSrc","src","email","push","AvatarService","base","md5","toLowerCase","build","display","bindAvatar","index","next","onerror","onload","AVATAR_CDNS","gravatar","weavatar","PROBE_TARGETS","probe","avatarServiceInited","init","winner","raceAvatarCDN","map","t","hit","find","this","emailHash","size","timeout","Promise","resolve","done","url","img","Image","timer","setTimeout","clearTimeout","iconKeyMap","doc_created","doc_updated","doc_author","doc_authors","applyTimeagoToTimes","timeNodes","rawLocale","timeago","tLocale","ddUtils","resolveTimeagoLocale","timeEl","dt","getAttribute","format","processDataLoading","ddpEl","getCurrentLocale","langData","TooltipLanguage","get","tippyEl","iconEl","rawIconKey","iconKey","content","tippyRaw","_tippy","setContent","updateDocumentDates","locale","saveLanguage","getCurrentTheme","body","tooltip_config","theme","dark","light","initTippy","context","tippyInstances","tippy","observer","MutationObserver","mutations","mutation","attributeName","newTheme","instance","setProps","observe","attributes","attributeFilter","initAuthorGroupTippyGuard","groupEl","_ddTippyGuardAbortController","abort","controller","AbortController","tippyTargets","hideAllTippies","hide","opts","passive","signal","addEventListener","window","ddPlugin","updateLanguage","tippyManager","initialize","cleanup","destroy","disconnect","enableHorizontalWheelScroll","navigator","maxTouchPoints","msMaxTouchPoints","_ddWheelAbortController","event","Math","abs","deltaY","deltaX","preventDefault","scrollWidth","clientWidth","delta","atLeft","scrollLeft","atRight","handleDocumentDatesAutoWrap","leftPart","rightPart","containerWidth","getBoundingClientRect","width","leftWidth","shouldWrap","classList","contains","toggle","initLayoutSwitcher","grids","savedLayout","localStorage","getItem","grid","switcher","previousElementSibling","listBtn","detailBtn","gridBtn","updateActiveBtn","layout","setLayout","remove","add","setItem","onclick","blur","datesAutoWrapObserver","initPluginFeatures","then","ResizeObserver","requestAnimationFrame","document$","isStopped","subscribe","readyState"],"sources":["assets/document_dates/core/core.js"],"mappings":"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","ignoreList":[],"sourcesContent":["/*\n    1.加载头像\n*/\nfunction isLatin(name) {\n    return /^[A-Za-z\\s]+$/.test(name.trim());\n}\nfunction extractInitials(name) {\n    name = name.trim();\n    if (!name) return '?';\n    if (isLatin(name)) {\n        const parts = name.toUpperCase().split(/\\s+/).filter(Boolean);\n        return parts.length >= 2 ? parts[0][0] + parts[parts.length - 1][0] : parts[0][0];\n    } else {\n        return name[0];\n    }\n}\nfunction nameToHSL(name, s = 50, l = 55) {\n    let hash = 0;\n    for (let i = 0; i < name.length; i++) {\n        hash = name.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    const hue = hash % 360;\n    return `hsl(${hue}, ${s}%, ${l}%)`;\n}\n\nfunction loadAvatars() {\n    document.querySelectorAll('.avatar-wrapper').forEach(wrapper => {\n        const name = wrapper.dataset.name || '';\n        const initials = extractInitials(name);\n        const bgColor = nameToHSL(name);\n\n        const textEl = wrapper.querySelector('.avatar-text');\n        textEl.textContent = initials;\n        textEl.style.backgroundColor = bgColor;\n\n        const imgEl = wrapper.querySelector('img.avatar');\n        if (imgEl) {\n            const urls = [];\n            const dataSrc = (imgEl.dataset.src || '').trim();\n            const email = (imgEl.dataset.email || '').trim();\n\n            if (dataSrc) {\n                urls.push(dataSrc);\n            }\n            if (email && AvatarService.base) {\n                const hash = md5(email.trim().toLowerCase());\n                urls.push(AvatarService.build(hash));\n            }\n            if (urls.length === 0) {\n                imgEl.style.display = 'none';\n                return;\n            }\n\n            bindAvatar(imgEl, urls);\n        }\n    });\n}\nfunction bindAvatar(imgEl, urls) {\n    let index = 0;\n    function next() {\n        if (index >= urls.length) {\n            imgEl.style.display = 'none';\n            return;\n        }\n        imgEl.src = urls[index++];\n    }\n    imgEl.onerror = next;\n    // 加载成功后清掉 onerror\n    imgEl.onload = () => imgEl.onerror = null;\n\n    next();\n}\n\nconst AVATAR_CDNS = {\n    // gravatar: 全球通用头像服务商，国内访问不稳定\n    // weavatar: gravatar 国内镜像，实测发现国内外访问都正常，数据跟 gravatar 一致\n    // cravatar: 国内头像服务商，有国际 CDN，很多开源项目在用，实测发现只包含部分 gravatar 数据\n\n    gravatar: 'https://www.gravatar.com/avatar',\n    weavatar: 'https://weavatar.com/avatar'\n    // cravatar: 'https://cravatar.cn/avatar'\n};\nconst PROBE_TARGETS = [\n    { name: 'gravatar', probe: 'https://www.gravatar.com/favicon.ico' },\n    { name: 'weavatar', probe: 'https://weavatar.com/favicon.ico' }\n];\n\nlet avatarServiceInited = false;\nconst AvatarService = {\n    base: null,\n    async init() {\n        if (avatarServiceInited) return;\n        avatarServiceInited = true;\n\n        const winner = await raceAvatarCDN(PROBE_TARGETS.map(t => t.probe));\n        if (!winner) return;\n\n        const hit = PROBE_TARGETS.find(t => t.probe === winner);\n        this.base = AVATAR_CDNS[hit.name];\n    },\n\n    // style: '404' 'wavatar' 'retro' 'identicon' 'mp' 'monsterid' 'robohash' 'blank'\n    // size: avatar size in pixels (1~2048)\n    build(emailHash, style = '404', size = 128) {\n        if (!this.base) return null;\n        return `${this.base}/${emailHash}?d=${style}&s=${size}`;\n    }\n};\nfunction raceAvatarCDN(urls, timeout = 500) {\n    return new Promise(resolve => {\n        let done = false;\n        urls.forEach(url => {\n            const img = new Image();\n            const timer = setTimeout(() => {\n                img.src = '';\n            }, timeout);\n            img.onload = () => {\n                if (done) return;\n                done = true;\n                clearTimeout(timer);\n                resolve(url);\n            };\n            img.onerror = () => {\n                clearTimeout(timer);\n            };\n            img.src = url;\n        });\n        // 兜底（全部失败 / 全部超时），不让 Promise 永远 pending\n        setTimeout(() => {\n            if (!done) resolve(null);\n        }, timeout);\n    });\n}\n\n\n\n/*\n    2.处理内容赋值\n*/\n// 图标键映射表\nconst iconKeyMap = {\n    doc_created: 'created_time',\n    doc_updated: 'updated_time',\n    doc_author: 'author',\n    doc_authors: 'authors'\n};\n\nfunction applyTimeagoToTimes(timeNodes, rawLocale) {\n    if (typeof timeago === 'undefined') {\n        return;\n    }\n    if (!timeNodes || !timeNodes.length) {\n        return;\n    }\n    const tLocale = ddUtils.resolveTimeagoLocale(rawLocale);\n    timeNodes.forEach(timeEl => {\n        const dt = timeEl.getAttribute('datetime');\n        if (dt) {\n            timeEl.textContent = timeago.format(dt, tLocale);\n        }\n    });\n}\n\n// 处理数据加载\nfunction processDataLoading() {    \n    document.querySelectorAll('.document-dates-plugin').forEach(ddpEl => {\n        const rawLocale = ddUtils.getCurrentLocale(ddpEl);\n\n        // 处理 time 元素（使用 timeago 时）\n        applyTimeagoToTimes(ddpEl.querySelectorAll('time'), rawLocale);\n\n        // 动态处理 tooltip 内容\n        const langData = TooltipLanguage.get(rawLocale);\n        ddpEl.querySelectorAll('[data-tippy-content]').forEach(tippyEl => {\n            const iconEl = tippyEl.querySelector('[data-icon]');\n            const rawIconKey = iconEl ? iconEl.getAttribute('data-icon') : '';\n            const iconKey = iconKeyMap[rawIconKey] || 'author';\n            if (langData[iconKey]) {\n                const content = langData[iconKey] + ': ' + tippyEl.dataset.tippyRaw;\n                if (tippyEl._tippy) {\n                    tippyEl._tippy.setContent(content);\n                }\n            }\n        });\n    });\n\n    // 处理其他 timeago 时间\n    const rawLocale = ddUtils.getCurrentLocale();\n    applyTimeagoToTimes(document.querySelectorAll('time.dd-timeago'), rawLocale);\n}\n\n// 供外部使用：更新文档日期和 tippy 内容到指定语言（可持久化）\nfunction updateDocumentDates(locale) {\n    ddUtils.saveLanguage(locale);\n    processDataLoading();\n}\nwindow.ddPlugin = {\n    updateLanguage: updateDocumentDates\n};\n\n\n\n/*\n    3.初始化 tippyManager，创建和管理 tippy 实例\n*/\nfunction getCurrentTheme() {\n    // 基于 Material's light/dark 配色方案返回对应的 tooltip 主题\n    const scheme = (document.body && document.body.getAttribute('data-md-color-scheme')) || 'default';\n    return scheme === 'slate' ? tooltip_config.theme.dark : tooltip_config.theme.light;\n}\n\nfunction initTippy() {\n    // 创建上下文对象，将其传递给钩子并从函数中返回\n    const context = { tooltip_config };\n\n    // 创建 tippy 实例\n    const tippyInstances = tippy('[data-tippy-content]', {\n        ...tooltip_config,\n        theme: getCurrentTheme()\n    });\n    context.tippyInstances = tippyInstances;\n\n    // 添加观察者，监控 Material's 配色变化，自动切换 tooltip 主题\n    const observer = new MutationObserver((mutations) => {\n        mutations.forEach((mutation) => {\n            if (mutation.attributeName === 'data-md-color-scheme') {\n                const newTheme = getCurrentTheme();\n                tippyInstances.forEach(instance => {\n                    instance.setProps({ theme: newTheme });\n                });\n            }\n        });\n    });\n    observer.observe(document.body, {\n        attributes: true,\n        attributeFilter: ['data-md-color-scheme']\n    });\n    context.observer = observer;\n\n    // 返回包含 tippyInstances 和 observer 的上下文，用于后续清理\n    return context;\n}\n\n// 在滚动时隐藏 author-group 的 tooltip\nfunction initAuthorGroupTippyGuard() {\n    document.querySelectorAll('.author-group').forEach(groupEl => {\n        // 先取消旧监听器，避免重复绑定\n        if (groupEl._ddTippyGuardAbortController) {\n            groupEl._ddTippyGuardAbortController.abort();\n        }\n        const controller = new AbortController();\n        groupEl._ddTippyGuardAbortController = controller;\n\n        const tippyTargets = groupEl.querySelectorAll('[data-tippy-content]');\n        const hideAllTippies = () => {\n            tippyTargets.forEach(tippyEl => {\n                if (tippyEl._tippy) {\n                    tippyEl._tippy.hide();\n                }\n            });\n        };\n        // true: 浏览器立刻执行默认行为。这个事件监听器只是‘看看’，绝不会阻止浏览器的默认行为\n        const opts = { passive: true, signal: controller.signal };\n        groupEl.addEventListener('scroll', hideAllTippies, opts);\n        groupEl.addEventListener('touchmove', hideAllTippies, opts);\n    });\n}\n\n// 通过 IIFE（立即执行的函数表达式）创建 tippyManager\nconst tippyManager = (() => {\n    let tippyInstances = [];\n    let observer = null;\n    function cleanup() {\n        // 销毁之前的 tippy 实例\n        if (tippyInstances.length > 0) {\n            tippyInstances.forEach(instance => instance.destroy());\n            tippyInstances = [];\n        }\n        // 断开之前的观察者连接\n        if (observer) {\n            observer.disconnect();\n            observer = null;\n        }\n    }\n    return {\n        // 每一次调用都生成新的实例（兼容 navigation.instant）\n        initialize() {\n            // 先清理以前的实例\n            cleanup();\n            // 初始化新实例\n            const context = initTippy();\n            if (context && context.tippyInstances) {\n                tippyInstances = context.tippyInstances;\n            }\n            if (context && context.observer) {\n                observer = context.observer;\n            }\n            initAuthorGroupTippyGuard();\n        }\n    };\n})();\n\n\n// 为 author-group 启用横向滚轮滚动\nfunction enableHorizontalWheelScroll() {\n    // 移动端不接管滚轮\n    const isTouchDevice =\n        'ontouchstart' in window ||\n        navigator.maxTouchPoints > 0 ||\n        navigator.msMaxTouchPoints > 0;\n    if (isTouchDevice) return;\n\n    document.querySelectorAll('.author-group').forEach(groupEl => {\n        // 先取消旧监听器，避免重复绑定\n        if (groupEl._ddWheelAbortController) {\n            groupEl._ddWheelAbortController.abort();\n        }\n        const controller = new AbortController();\n        groupEl._ddWheelAbortController = controller;\n\n        groupEl.addEventListener('wheel', function (event) {\n            // 只处理纵向滚轮（触控板横向滑动不干预）\n            if (Math.abs(event.deltaY) <= Math.abs(event.deltaX)) return;\n            // 在 author-group 内，始终阻止页面纵向滚动\n            event.preventDefault();\n\n            const scrollWidth = groupEl.scrollWidth;\n            const clientWidth = groupEl.clientWidth;\n            // 元素不可横向滚动时返回\n            if (scrollWidth <= clientWidth) return;\n\n            const delta = event.deltaY;\n            const atLeft = groupEl.scrollLeft <= 0;\n            const atRight = groupEl.scrollLeft + clientWidth >= scrollWidth - 1;\n\n            if ((delta < 0 && !atLeft) || (delta > 0 && !atRight)) {\n                groupEl.scrollLeft += delta;\n            }\n        }, {\n            // false: 浏览器你先别急着执行默认行为，等 JS 跑完，再决定要不要动，因为可能会调用 event.preventDefault()\n            passive: false,\n            signal: controller.signal\n        });\n    });\n}\n\n\n// 为 author-group 添加自适应动态布局\nfunction handleDocumentDatesAutoWrap() {\n    // 设定作者区域最小的显示宽度，大概2个作者宽度\n    const AUTHOR_THRESHOLD = 140;\n    document.querySelectorAll('.document-dates-plugin').forEach(ddpEl => {\n        const leftPart = ddpEl.querySelector('.dd-left');\n        const rightPart = ddpEl.querySelector('.dd-right');\n        if (!leftPart || !rightPart) return;\n\n        // 使用 getBoundingClientRect 更加精确（包含小数）\n        const containerWidth = ddpEl.getBoundingClientRect().width;\n        const leftWidth = leftPart.getBoundingClientRect().width;\n        if (containerWidth <= leftWidth) return;\n\n        // 如果: 容器总宽度 < 日期宽度 + 2个作者宽度，则换行\n        const shouldWrap = containerWidth < (leftWidth + AUTHOR_THRESHOLD);\n        // 只有在状态确实需要改变时才操作 DOM\n        if (ddpEl.classList.contains('is-wrapped') !== shouldWrap) {\n            ddpEl.classList.toggle('is-wrapped', shouldWrap);\n        }\n    });\n}\n\n// 最近更新 - 布局切换器 (Layout Switcher)\nfunction initLayoutSwitcher() {\n    const grids = document.querySelectorAll('.article-grid');\n    if (!grids.length) return;\n\n    const savedLayout = localStorage.getItem('dd_recent_docs_layout') || 'grid';\n\n    grids.forEach(grid => {\n        // 应用初始布局\n        grid.classList.toggle('is-list', savedLayout === 'list');\n        grid.classList.toggle('is-detail', savedLayout === 'detail');\n\n        // 查找或创建切换器容器\n        let switcher = grid.previousElementSibling;\n        if (!switcher || !switcher.classList.contains('article-layout-switcher')) {\n            // 如果模板中没写，可以动态注入，但建议写在模板里以保证 UI 一致性\n            return;\n        }\n\n        const listBtn = switcher.querySelector('.layout-list-btn');\n        const detailBtn = switcher.querySelector('.layout-detail-btn');\n        const gridBtn = switcher.querySelector('.layout-grid-btn');\n\n        const updateActiveBtn = (layout) => {\n            if (listBtn) listBtn.classList.toggle('is-active', layout === 'list');\n            if (detailBtn) detailBtn.classList.toggle('is-active', layout === 'detail');\n            if (gridBtn) gridBtn.classList.toggle('is-active', layout === 'grid');\n        };\n\n        updateActiveBtn(savedLayout);\n\n        const setLayout = (layout) => {\n            grid.classList.remove('is-list', 'is-detail');\n            if (layout !== 'grid') {\n                grid.classList.add(`is-${layout}`);\n            }\n            localStorage.setItem('dd_recent_docs_layout', layout);\n            updateActiveBtn(layout);\n        };\n\n        if (listBtn) {\n            listBtn.onclick = () => {\n                setLayout('list');\n                listBtn.blur();\n            };\n        }\n        if (detailBtn) {\n            detailBtn.onclick = () => {\n                setLayout('detail');\n                detailBtn.blur();\n            };\n        }\n        if (gridBtn) {\n            gridBtn.onclick = () => {\n                setLayout('grid');\n                gridBtn.blur();\n            };\n        }\n    });\n}\n\n/*\n    入口\n*/\nlet datesAutoWrapObserver = null;\nfunction initPluginFeatures() {\n    tippyManager.initialize();\n    processDataLoading();\n    initLayoutSwitcher();\n    AvatarService.init().then(() => {\n        loadAvatars();\n    });\n    enableHorizontalWheelScroll();\n\n    // 观察插件尺寸变化，resize 时动态处理布局\n    if (datesAutoWrapObserver) datesAutoWrapObserver.disconnect();\n    datesAutoWrapObserver = new ResizeObserver(() => {\n        // 使用 RAF 确保在浏览器重绘前处理，减少视觉跳动\n        window.requestAnimationFrame(() => {\n            handleDocumentDatesAutoWrap();\n        });\n    });\n    document.querySelectorAll('.document-dates-plugin').forEach(ddpEl => datesAutoWrapObserver.observe(ddpEl));\n    setTimeout(handleDocumentDatesAutoWrap, 100);\n}\n\n// 兼容 Material 主题的 'navigation.instant' 属性\nif (window.document$ && !window.document$.isStopped) {\n    window.document$.subscribe(initPluginFeatures);\n} else if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initPluginFeatures);\n} else {\n    initPluginFeatures();\n}\n"]}