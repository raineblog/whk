name: Export to PDF

on:
  schedule:
    - cron: '0 0 1 * *'
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  export:
    name: Export
    timeout-minutes: 20
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main
        uses: actions/checkout@v5
        with:
          submodules: 'true'
      - name: Setup Typst
        uses: typst-community/setup-typst@v4
      - name: Install uv
        uses: astral-sh/setup-uv@v7
      - name: Install Dependencies
        run: uv pip install --group export
      - name: Export to PDF
        run: uv run poe export
      - name: Upload Artifact
        uses: actions/upload-artifact@v5
        with:
          name: PDF
          path: ./cache/*.pdf
  release:
    name: Release
    runs-on: ubuntu-latest
    needs: export
    steps:
    - name: Download artifact
      uses: actions/download-artifact@v6
      with:
        merge-multiple: true
        path: ./
    - name: Get Time
      id: gettime
      run: echo "utc_time=$(date -u +'%Y%m%d%H%M')" >> $GITHUB_OUTPUT
    - name: Upload to Release
      uses: softprops/action-gh-release@v2
      with:
        files: ./*.pdf
        tag_name: ${{ steps.gettime.outputs.utc_time }}
